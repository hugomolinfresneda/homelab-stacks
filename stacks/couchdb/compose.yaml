# homelab-stacks/stacks/couchdb/compose.yaml
# -------------------------------------------------------------------
# Base definition of the CouchDB stack (v3.x)
# Self-hosted document database (Obsidian LiveSync ready)
# Portable and environment-agnostic. No ports exposed by default.
# Local overrides live in homelab-runtime/stacks/couchdb/
# -------------------------------------------------------------------

services:
  couchdb:
    image: couchdb@sha256:d3fb6f79033173171d6f73f8c7f9d8e2c885a83fc88125991dba1f8e6a936577
    container_name: couchdb
    expose:
      - "5984"
    environment:
      COUCHDB_USER: ${COUCHDB_USER:-admin}
      COUCHDB_PASSWORD: ${COUCHDB_PASSWORD:-change-me}
    networks:
      - proxy
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-fsS", "http://127.0.0.1:5984/_up"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 15s
    labels:
      com.repo: homelab-stacks
      com.stack: couchdb
      com.env: lab

networks:
  proxy:
    external: true
