# Copy to infra.backups.rules.yml and replace <BACKUPS_MOUNTPOINT> with your backup mountpoint.
groups:
  - name: infra.disk.backups
    rules:
      - alert: BackupDiskNotMounted
        expr: >-
          absent(node_filesystem_size_bytes{job="node",mountpoint="<BACKUPS_MOUNTPOINT>",fstype="ext4"})
        labels:
          severity: critical
          service: backup
          component: host
          scope: infra
        annotations:
          summary: Backup disk is not mounted
          description: >-
            The expected backup mountpoint ({{ $labels.mountpoint }}) is missing. Backups
            may fail or write to the wrong filesystem.
          runbook_url: >-
            https://github.com/hugomolinfresneda/homelab-stacks/blob/main/stacks/monitoring/runbooks/BackupDiskNotMounted.md
        for: 5m
      - alert: BackupDiskSpaceLow
        expr: >-
          (node_filesystem_avail_bytes{job="node",mountpoint="<BACKUPS_MOUNTPOINT>",fstype="ext4"}
          /
          node_filesystem_size_bytes{job="node",mountpoint="<BACKUPS_MOUNTPOINT>",fstype="ext4"})
          < 0.10
        labels:
          severity: critical
          service: backup
          component: host
          scope: infra
        annotations:
          summary: Backup disk is low on space
          description: >-
            The backup filesystem ({{ $labels.mountpoint }}) has less than 10% free space.
            Backups may start failing soon.
        for: 15m
